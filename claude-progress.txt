# PuraToDo Development Progress

## Project Overview
A modern todo application built with Next.js 16+, Supabase, and Tailwind CSS.
Supports groups, lists, and infinitely nested tasks.

## Tech Stack
- Frontend: Next.js 16+ (App Router) + TypeScript + Tailwind CSS v4 + shadcn/ui
- Backend: Supabase (PostgreSQL + Auth + Realtime + RLS)
- Testing: Playwright MCP (E2E)

## Data Model

```
users (Supabase Auth)
    └── groups (1:N)
            └── lists (1:N)
                    └── tasks (1:N, self-referencing for subtasks)
```

All tables include user_id for RLS policies and query optimization.

---

### 2026-02-16

#### 完成
- Feature #18: List UI - 显示列表
  - 创建 src/actions/lists.ts server action（getLists, createList, updateList, deleteList, reorderLists, moveListToGroup）
  - 创建 src/components/dashboard/list-panel.tsx 列表面板组件
  - 更新 Sidebar 组件支持分组选择（selectedGroupId, onGroupSelect）
  - 重构 Dashboard 页面，分离 DashboardContent 客户端组件
  - 列表显示名称和 emoji 图标
  - 修复分组切换后列表不更新的问题（改进点击事件处理）
- Feature #19: List Create - 创建列表
  - 已在 ListPanel 中实现创建对话框
  - 支持名称和 12 种 emoji 图标选择
  - 测试通过
- Feature #17.5: Sidebar Tree - 侧边栏树形结构
  - 重构 Sidebar 组件支持在分组下方显示子列表
  - 添加展开/收起功能（ChevronRight/ChevronDown 图标）
  - 显示列表数量徽章
  - 点击列表更新主区域标题
  - 点击分组菜单可添加列表
  - 测试通过
- Feature #20: List Edit - 编辑列表
  - 编辑对话框已存在于 ListPanel
  - 支持修改名称和图标
  - 测试通过
- Feature #21: List Delete - 删除列表
  - 删除确认对话框已存在于 ListPanel
  - 显示删除警告（会删除关联任务）
  - 测试通过
- Feature #22: List Sort - 拖拽排序列表
  - 使用 @dnd-kit 在 ListPanel 中添加拖拽排序功能
  - 创建 SortableListItem 组件处理单个可排序列表项
  - 添加 GripVertical 拖拽手柄，hover 时显示
  - 使用 reorderLists server action 批量更新 sort_order
  - 测试通过：拖拽排序后刷新页面顺序持久化
- Feature #23: List Move - 移动列表到其他分组
  - 在 ListPanel 中添加移动对话框
  - 显示可选的目标分组列表（排除当前分组）
  - 使用 moveListToGroup server action 更新 group_id
  - 添加 FolderInput 图标到 Move 菜单项
  - 测试通过：列表成功移动到其他分组并持久化
- 侧边栏列表拖拽排序
  - 添加 SortableSidebarListItem 组件
  - 在每个分组内添加独立的 DndContext 处理列表排序
  - 侧边栏和主面板列表排序同步更新
  - 测试通过
- Feature #24: Task UI - 显示任务
  - 创建 src/actions/tasks.ts server action（getTasks, createTask, updateTask, deleteTask, reorderTasks）
  - 创建 src/components/dashboard/task-panel.tsx 任务面板组件
  - 安装 shadcn/ui Checkbox 组件
  - 更新 dashboard-content.tsx 根据 selectedListId 显示任务面板
  - 测试通过
- Feature #25: Task Create - 创建任务
  - TaskPanel 中添加内联输入创建任务
  - 支持 Enter 快捷键提交
  - 测试通过
- Feature #26: Task Complete - 标记完成
  - 使用 Checkbox 组件切换完成状态
  - 完成任务显示删除线样式
  - 测试通过
- Feature #30: Task Star - 星标任务
  - 点击星标图标切换 starred 状态
  - 测试通过
- Feature #27: Task Edit - 编辑任务名称
  - 添加 SortableTaskItem 组件支持内联编辑
  - 点击 Edit 菜单项进入编辑模式
  - Enter 保存，Escape 取消
  - 测试通过
- Feature #28: Task Delete - 删除任务
  - 添加删除确认对话框
  - 点击 Delete 确认后删除任务
  - 测试通过
- Feature #29: Task Sort - 拖拽排序任务
  - 使用 @dnd-kit 添加拖拽排序功能
  - 添加 GripVertical 拖拽手柄
  - 调用 reorderTasks server action 持久化排序
  - 测试通过：拖拽排序后刷新页面顺序持久化
- Feature #31: Task Detail Panel - 任务详情面板
  - 创建 src/components/dashboard/task-detail-sheet.tsx 组件
  - 安装 shadcn/ui popover, calendar, sheet, textarea 组件
  - 点击任务名称打开右侧滑出详情面板
  - 详情面板支持编辑所有任务属性
  - 测试通过
- Feature #32: Task Due Date - 设置截止日期
  - 使用 Calendar 组件选择日期
  - 支持 Clear 按钮清除日期
  - 日期格式化显示 (format from date-fns)
  - 测试通过
- Feature #33: Task Plan Date - 设置计划日期
  - 与 Due Date 相同的日期选择器实现
  - 测试通过
- Feature #34: Task Comment - 添加备注
  - 使用 Textarea 组件
  - 支持多行文本输入
  - 测试通过
- Feature #35: Task Duration - 设置时长
  - 使用 Input type="number" 组件
  - 以分钟为单位
  - 测试通过
- Feature #36: Task Subtask - 创建子任务
  - 更新 src/actions/tasks.ts 添加 getTasksWithSubtasks 函数（递归获取嵌套子任务）
  - 更新 Task 类型添加 subtasks 可选字段
  - 重构 TaskPanel 组件支持递归渲染嵌套任务
  - 添加 TaskItem 组件处理单个可排序任务项（支持展开/收起子任务）
  - 添加 ChevronRight/ChevronDown 图标用于展开/收起
  - 添加 "Add Subtask" 菜单项
  - 子任务可独立完成
  - 测试通过
- Feature #37: Task Nested Subtask - 无限嵌套子任务
  - 递归渲染支持无限层级
  - 使用 level 参数控制缩进
  - 每层子任务有独立的展开/收起功能
  - 测试通过 3 层嵌套
  - 刷新后数据持久化正常
- Feature #38: Light/dark theme toggle support - 主题切换
  - 安装 next-themes 包
  - 创建 src/components/theme-provider.tsx 主题提供者组件
  - 创建 src/components/theme-toggle.tsx 主题切换按钮组件
  - 更新 layout.tsx 添加 ThemeProvider 和 suppressHydrationWarning
  - 在 Sidebar header 添加主题切换按钮
  - 支持 Light、Dark、System 三种模式
  - 主题持久化到 localStorage
  - 测试通过：切换主题、刷新页面持久化、切换回原主题
- Feature #39: Responsive layout for mobile devices - 移动端响应式布局
  - 更新 dashboard-content.tsx 添加响应式布局
  - 使用 Sheet 组件实现移动端侧边栏滑出菜单
  - 桌面端显示固定侧边栏，移动端隐藏
  - 添加汉堡菜单按钮（Menu 图标）仅在移动端显示
  - 点击菜单项自动关闭移动端侧边栏
  - 调整主内容区 padding 适配移动端
  - 测试通过：移动端汉堡菜单、侧边栏滑出、点击导航、桌面端布局
- Feature #40: Keyboard shortcuts for common operations - 键盘快捷键
  - 创建 src/hooks/use-keyboard-shortcuts.ts 自定义 Hook
  - 创建 src/components/keyboard-shortcuts-dialog.tsx 快捷键帮助对话框
  - 更新 ListPanel 和 TaskPanel 使用 forwardRef 暴露创建方法
  - 更新 dashboard-content.tsx 集成键盘快捷键
  - 支持 N（新建任务/列表）、L（新建列表）、?（显示帮助）、Esc（关闭对话框）
  - 快捷键在输入框中自动禁用
  - 在 header 添加快捷键帮助按钮
  - 测试通过：? 显示帮助、Esc 关闭对话框、N 创建任务/列表
- Feature #41: Loading states with skeleton screens - 骨架屏加载状态
  - 安装 shadcn/ui skeleton 组件
  - 创建 src/components/dashboard/skeletons.tsx 骨架屏组件
  - 创建 SidebarSkeleton、ListPanelSkeleton、TaskPanelSkeleton 组件
  - 创建 src/app/dashboard/loading.tsx 页面加载骨架屏
  - 更新 TaskPanel 添加 isLoadingTasks 状态，加载时显示骨架屏
  - 测试通过：页面加载和任务列表切换时骨架屏显示
- Feature #42: Empty state prompts when no data exists - 空状态提示
  - 已在先前功能中实现，验证测试通过
  - Sidebar: "No groups yet" + "Create your first group" 按钮
  - ListPanel: "No lists in this group yet" + "Create your first list" 按钮
  - TaskPanel: "No tasks in this list yet" + "Create your first task" 按钮
  - 测试通过：分组、列表、任务的空状态均正确显示
- Feature #43: Global search across all tasks - 全局搜索
  - 添加 searchTasks server action 在 src/actions/tasks.ts
  - 创建 src/components/search-dialog.tsx 搜索对话框组件
  - 支持 Ctrl/Cmd+K 快捷键打开搜索
  - 搜索结果显示任务名称、状态、星标、截止日期、所属列表和分组
  - 点击结果导航到对应列表
  - 更新键盘快捷键帮助文档
  - 测试通过：搜索、点击结果导航
- Feature #44: Filter tasks by status, date, star - 任务筛选
  - 在 TaskPanel 添加筛选下拉菜单
  - 支持按状态筛选（All/Completed/Incomplete）
  - 支持按星标筛选（All/Starred/Unstarred）
  - 支持按日期筛选（All/Overdue/Today/Upcoming/No Due Date）
  - 支持组合筛选
  - 显示筛选后的任务数量（如 "0 of 3 tasks"）
  - 空状态提示"No tasks match your filters"和清除筛选按钮
  - 测试通过：Completed 筛选、Clear Filters
- Feature #45: Today view showing tasks with plan_date = today - 今日视图
  - 添加 getTodayTasks server action 在 src/actions/tasks.ts
  - 创建 src/components/dashboard/today-panel.tsx 今日面板组件
  - 在 Sidebar 添加 "Today" 快捷入口（太阳图标）
  - 显示今天的日期和计划任务
  - 任务按列表分组显示
  - 空状态提示设置 plan_date 的说明
  - 测试通过：Today 视图导航、日期显示
- Feature #46: Realtime sync across multiple devices - 实时同步
  - 创建 src/hooks/use-realtime.ts 自定义 Hook
  - 订阅 Supabase Postgres Changes
  - TaskPanel 订阅任务表变化
  - DashboardContent 订阅分组和列表表变化
  - TodayPanel 订阅任务表变化
  - 测试通过：两个浏览器标签同步任务创建

---

### 2026-02-15

### 2026-02-15

#### 完成
- 重构 feature_list.json：从 phase 嵌套结构改为扁平数字编号 (1-52)
- 为每个 feature 添加 steps 字段，指导 Playwright 测试步骤
- 更新 claude-progress.txt 适配新格式
- Feature #16: Group Sort - 拖拽排序分组
  - 安装 @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities
  - 添加 reorderGroups server action 批量更新 sort_order
  - 更新 Sidebar 组件支持拖拽排序（SortableGroupItem 组件）
  - 添加 GripVertical 拖拽手柄，hover 时显示
- Feature #18: List UI - 显示列表
  - 创建 src/actions/lists.ts server action（getLists, createList, updateList, deleteList, reorderLists, moveListToGroup）
  - 创建 src/components/dashboard/list-panel.tsx 列表面板组件
  - 更新 Sidebar 组件支持分组选择（selectedGroupId, onGroupSelect）
  - 重构 Dashboard 页面，分离 DashboardContent 客户端组件
  - 列表显示名称和 emoji 图标

#### 下一步
- **Feature #17.5: Sidebar Tree - 侧边栏树形结构显示列表（新增）**
- 实现 Feature #19: List Create - 创建列表（已在测试中实现）
- 实现 Feature #20: List Edit - 编辑列表（已在测试中实现）
- 实现 Feature #21: List Delete - 删除列表（已在测试中实现）
- 继续实现 Feature #22-23: List Sort/Move

---

### 2026-02-14

#### 完成
- Feature #12: Group List UI - 侧边栏显示分组列表
- Feature #13: Group Create - 创建分组（名称+颜色选择器）
- Feature #14: Group Edit - 编辑分组名称和颜色
- Feature #15: Group Delete - 删除分组（带确认对话框）
- Feature #17: Group Sidebar - 左侧固定侧边栏布局

#### 下一步
- 实现 Feature #16: Group Sort 或继续 List Module

---

### 2026-02-13

#### 完成
- Feature #6-11: 完整认证系统
  - #6: 登录页面 UI
  - #7: 用户注册
  - #8: 用户登录
  - #9: 用户登出
  - #10: Session 持久化
  - #11: 路由保护

#### 下一步
- Group Module 功能实现

---

### 2026-02-12

#### 完成
- Feature #1-5: 项目初始化
  - #1: Next.js 项目脚手架
  - #2: shadcn/ui 安装配置
  - #3: Supabase 项目创建
  - #4: 数据库 Schema
  - #5: Supabase Client 配置

#### 下一步
- 认证系统实现

---

## Notes
- Using Tailwind CSS v4 (latest)
- Next.js 16.1.6 with App Router
- shadcn/ui with new-york style, neutral color scheme
- All features tested with Playwright MCP
