# PuraToDo Tauri App - Progress Log

## Session 6: @dnd-kit Drag-and-Drop Unification
**Date:** 2026-02-21

### What was done
Unified drag-and-drop functionality between Tauri app and web app by replacing HTML5 native drag with @dnd-kit:

1. **Created shared components in @puratodo/ui:**
   - `packages/ui/src/components/drag-handle.tsx` - Reusable DragHandle component with GripVertical icon
   - `packages/ui/src/components/sortable-item.tsx` - SortableItem wrapper using @dnd-kit's useSortable hook
   - Exported both components from `packages/ui/src/index.ts`

2. **Added @dnd-kit dependencies:**
   - Added @dnd-kit/core, @dnd-kit/sortable, @dnd-kit/utilities to packages/ui
   - Added same dependencies to apps/app

3. **Refactored DashboardPage.tsx:**
   - Replaced HTML5 native drag-and-drop with @dnd-kit
   - Created SortableGroupItem, SortableListItem, SortableTaskItem components
   - Added DndContext and SortableContext wrappers for groups, lists, and tasks
   - Added drag handlers (handleGroupDragStart/End, handleListDragStart/End, handleTaskDragStart/End)
   - Removed old HTML5 drag state variables and functions
   - Drag handles now show on hover (matching web app behavior)

### Key Changes
- Groups can be reordered via drag-and-drop with visible drag handle
- Lists can be reordered within their group via drag-and-drop
- Tasks can be reordered within their list via drag-and-drop
- Subtasks can be reordered within their parent task
- All drag operations use GripVertical drag handle that appears on hover

### Features Updated
- id 22: Reorder groups via drag and drop (needs manual testing)
- id 30: Reorder lists via drag and drop (needs manual testing)
- id 36: Reorder tasks via drag and drop (needs manual testing)

### Technical Notes
- @dnd-kit provides better cross-platform compatibility than HTML5 drag
- Uses PointerSensor with 5px activation constraint for touch/pointer devices
- Uses KeyboardSensor for accessibility
- arrayMove from @dnd-kit/sortable handles reordering logic

### Build Status
- packages/ui: Builds successfully
- apps/app: Builds successfully
- Tauri dev: Starts successfully

### Next Steps
- Manual testing of drag-and-drop in Tauri app
- Test keyboard accessibility of drag operations
- Verify order persistence after app restart

---

## Session 5: Three-Column Responsive Layout
**Date:** 2026-02-21

### What was done
Implemented a three-column responsive layout for the Tauri app to match the web app's design:

1. **Created new files:**
   - `src/hooks/useBreakpoint.ts` - Hook for detecting responsive breakpoints (xs, sm, md, lg, xl)
   - `src/components/TaskDetailPanel.tsx` - Right-side task detail panel for xl+ screens
   - `src/components/TaskDetailSheet.tsx` - Bottom sheet for task details on smaller screens

2. **Modified DashboardPage.tsx:**
   - Added responsive state management (sidebarOpen, selectedTaskId, mobileDetailOpen)
   - Added hamburger menu button for xs breakpoint
   - Implemented conditional sidebar rendering (Sheet on xs, fixed aside on larger screens)
   - Added right-side detail panel for xl+ screens
   - Added TaskDetailSheet for sm/md screens
   - Removed old Task Detail Dialog
   - Fixed TypeScript errors with null checks for drag-and-drop handlers

### Responsive Behavior
| Breakpoint | Width | Sidebar | Task Detail |
|------------|-------|---------|-------------|
| xs | < 640px | Sheet (hamburger menu) | Bottom Sheet |
| sm/md | 640-1279px | Fixed sidebar | Bottom Sheet |
| lg/xl | ≥ 1280px | Fixed sidebar | Right Panel |

### Testing
- Build verified successfully
- Tauri dev server starts without errors
- TypeScript compilation passes (only unused variable warnings remain)

### Next Steps
- Manual testing of responsive breakpoints
- Test task detail editing in both panel and sheet views
- Consider adding subtask support to TaskDetailPanel

---

## Session 4: Fix Delete Account Function
**Date:** 2026-02-20

### Problem
Delete account function in multi-account management was not working properly. The issue was that the code used native browser `confirm()` dialog which may not work correctly in Tauri environment.

### What was done
Modified `AccountSettingsDialog.tsx`:
1. Replaced native `confirm()` with custom confirmation dialog using shadcn/ui Dialog component
2. Added `deleteAccountId` state to track which account to delete
3. Split the delete logic into `handleRemoveAccount`, `confirmRemoveAccount`, and `cancelRemoveAccount`
4. Added a confirmation dialog that shows the email of the account being removed
5. Used React Fragment to wrap both dialogs

### Testing
- Tested by adding a mock second account via localStorage
- Confirmed that clicking delete button shows the confirmation dialog
- Confirmed that clicking "Remove" successfully deletes the account
- Confirmed that clicking "Cancel" closes the dialog without deleting
- Build verified successfully

### Result
Delete account function now works correctly with a proper confirmation dialog.

---

## Session 3: Scrollbar Fix
**Date:** 2026-02-20

### What was done
Fixed page scrollbar issue where the entire page (including header and sidebar) would scroll when there were many tasks, instead of just the task list area.

**Changes made to `DashboardPage.tsx`:**
1. Line 977: Changed outer container from `min-h-screen flex` to `h-screen overflow-hidden flex`
2. Line 1379: Added `overflow-hidden` to main area
3. Line 1401: Added `overflow-y-auto` to content area

**Result:** Now only the task list content area scrolls, while header and sidebar remain fixed.

---

## Session 2: Multi-Account UI Improvements
**Date:** 2026-02-20

### What was done
1. Modified LoginPage.tsx:
   - Removed "API Server" link from top-right corner
   - Added server URL input field directly in the login form (above email/password)
   - Shows default URL (http://localhost:3000) on first login
   - Validates server URL before login

2. Created AccountSwitcher.tsx component:
   - Shows current account avatar + email + server short name in header
   - Dropdown menu with all saved accounts
   - Current account has checkmark indicator
   - "Add new account" option - signs out current account but keeps others for switching
   - "Manage accounts" option - opens AccountSettingsDialog
   - "Sign out" option - signs out completely (removes all accounts)

3. Modified authStore.ts:
   - Added signOutCurrentAccount() function for switching accounts cleanly

4. Modified DashboardPage.tsx:
   - Integrated AccountSwitcher in the header (top-right area)

### Next Steps
- Run app and verify:
  - [ ] Login page shows server URL input
  - [ ] Can log in with custom server URL
  - [ ] Header shows current account info
  - [ ] Dropdown shows all accounts
  - [ ] Can switch between accounts
  - [ ] "Add new account" works
  - [ ] "Manage accounts" dialog opens
  - [ ] "Sign out" works

---

## Session 1: Feature Alignment with Web App
**Date:** 2026-02-20

### Background
- 重构 feature_list.json：从 209 条精简为 ~80 条（与 web 对齐）
- 所有测试设为 passes: false，需要逐项验证
- 发现 app 可能存在 bugs 和 UI 风格与 web 不一致的问题

### Current Status
- 13/79 items passing (功能 #1-3, #5-7, #9, #11, #18, #32-33, #38, #49-50)
- 已验证核心功能正常工作
- 深色模式正常工作

### Next Steps
1. 启动 Tauri app (`./init.sh app`)
2. 逐项验证功能是否正常工作
3. 修复发现的问题
4. 统一 UI 风格与 web 保持一致
